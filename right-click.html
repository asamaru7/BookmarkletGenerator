<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/style.css">

	<link rel="stylesheet" href="codemirror/lib/codemirror.css">
	<link rel="stylesheet" href="codemirror/theme/night.css">

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="codemirror/lib/codemirror.js"></script>
	<script src="codemirror/mode/javascript/javascript.js"></script>
	<script src="codemirror/addon/edit/matchbrackets.js"></script>
	<script src="codemirror/addon/edit/continuelist.js"></script>

	<title>Bookmarklet Generator - build jquery powered bookmarklet in no time</title>
</head>
<body>

<a href="https://github.com/asamaru7/BookmarkletGenerator"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:9999;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
	 style="display:block; margin:30px auto;"
	 data-ad-client="ca-pub-8163803188491150"
	 data-ad-slot="7540374229"
	 data-ad-format="auto"></ins>
<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
</script>

<h2>Bookmarklet Generator</h2>

<form>
    <textarea id="code" name="code">
(function () {
	if (window.subvaAllowRightClick === undefined) {
		// https://greasyfork.org/en/scripts/23772-absolute-enable-right-click-copy/code
		window.subvaAllowRightClick = function (dom) {
			(function GetSelection() {
				var Style = dom.createElement('style');
				Style.type = 'text/css';
				var TextNode = '*{user-select:text!important;-webkit-user-select:text!important;}';
				if (Style.styleSheet) {
					Style.styleSheet.cssText = TextNode;
				}
				else {
					Style.appendChild(dom.createTextNode(TextNode));
				}
				dom.getElementsByTagName('head')[0].appendChild(Style);
			})();

			(function SetEvents() {
				var events = ['copy', 'cut', 'paste', 'select', 'selectstart'];
				for (var i = 0; i < events.length; i++)
					dom.addEventListener(events[i], function (e) {
						e.stopPropagation();
					}, true);
			})();

			(function RestoreEvents() {
				var n = null;
				var d = document;
				var b = dom.body;
				var SetEvents = [d.oncontextmenu = n, d.onselectstart = n, d.ondragstart = n, d.onmousedown = n];
				var GetEvents = [b.oncontextmenu = n, b.onselectstart = n, b.ondragstart = n, b.onmousedown = n, b.oncut = n, b.oncopy = n, b.onpaste = n];
			})();

			(function RightClickButton() {
				setTimeout(function () {
					dom.oncontextmenu = null;
				}, 2000);
				function EventsCall(callback) {
					this.events = ['DOMAttrModified', 'DOMNodeInserted', 'DOMNodeRemoved', 'DOMCharacterDataModified', 'DOMSubtreeModified'];
					this.bind();
				}

				EventsCall.prototype.bind = function () {
					this.events.forEach(function (event) {
						dom.addEventListener(event, this, true);
					}.bind(this));
				};
				EventsCall.prototype.handleEvent = function () {
					this.isCalled = true;
				};
				EventsCall.prototype.unbind = function () {
					this.events.forEach(function (event) {
					}.bind(this));
				};
				function EventHandler(event) {
					this.event = event;
					this.contextmenuEvent = this.createEvent(this.event.type);
				}

				EventHandler.prototype.createEvent = function (type) {
					var target = this.event.target;
					var event = target.ownerDocument.createEvent('MouseEvents');
					event.initMouseEvent(type, this.event.bubbles, this.event.cancelable,
						target.ownerDocument.defaultView, this.event.detail,
						this.event.screenX, this.event.screenY, this.event.clientX, this.event.clientY,
						this.event.ctrlKey, this.event.altKey, this.event.shiftKey, this.event.metaKey,
						this.event.button, this.event.relatedTarget);
					return event;
				};
				EventHandler.prototype.fire = function () {
					var target = this.event.target;
					var contextmenuHandler = function (event) {
						event.preventDefault();
					}.bind(this);
					target.dispatchEvent(this.contextmenuEvent);
					this.isCanceled = this.contextmenuEvent.defaultPrevented;
				};
				window.addEventListener('contextmenu', handleEvent, true);
				function handleEvent(event) {
					event.stopPropagation();
					event.stopImmediatePropagation();
					var handler = new EventHandler(event);
					window.removeEventListener(event.type, handleEvent, true);
					var EventsCallBback = new EventsCall(function () {
					});
					handler.fire();
					window.addEventListener(event.type, handleEvent, true);
					if (handler.isCanceled && (EventsCallBback.isCalled))
						event.preventDefault();
				}
			})();

			// function KeyPress(e) {
			// 	if (e.altKey && e.ctrlKey) {
			// 		if (confirm("Activate Absolute Right Click Mode!") === true) {
			// 			Absolute_Mod();
			// 		}
			// 	}
			// }
			// dom.addEventListener("keydown", KeyPress);

			(function Absolute_Mod() {
				var events = ['contextmenu', 'copy', 'cut', 'paste', 'mouseup', 'mousedown', 'keyup', 'keydown', 'drag', 'dragstart', 'select', 'selectstart'];
				for (var i = 0; i < events.length; i++) {
					dom.addEventListener(events[i], function (e) {
						e.stopPropagation();
					}, true);
				}
			})();
		};

//		window.subvaAllowRightClick(document);

		function runAll(w) {
			try {
				window.subvaAllowRightClick(w.document);
			} catch (e) {
			}
			for (var i = 0; i < w.frames.length; i++) {
				runAll(w.frames[i]);
			}
		}
	}
	runAll(window);
})();
    </textarea>
</form>

<a id="bookmarklet" href="">
	drag into your bookmark-toolbar
</a>

<script type="text/javascript">
	$(function () {

		var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
			lineNumbers: true,
			matchBrackets: true,
			extraKeys: {
				"Enter": "newlineAndIndentContinueComment"
			}
		});

		$('a#bookmarklet').on('mousedown', function () {
			editor.save();
			var value = encodeURI($('textarea#code').val());
			$('a#bookmarklet').attr('href', "javascript:" + value)
		});

	});
</script>
</body>